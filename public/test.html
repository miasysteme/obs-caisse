<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBS CAISSE - Test Interface</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #1976d2, #42a5f5);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 1.8rem;
            font-weight: 500;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #1976d2;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }
        
        .status-success {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        
        .status-error {
            background: #ffeaea;
            border-left: 4px solid #f44336;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        
        .status-loading {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e3f2fd;
            border-top: 2px solid #2196f3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .btn {
            background: #1976d2;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem 0.5rem 0.5rem 0;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #1565c0;
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .btn-outline {
            background: transparent;
            color: #1976d2;
            border: 1px solid #1976d2;
        }
        
        .btn-outline:hover {
            background: #1976d2;
            color: white;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #f5f5f5;
            font-weight: 500;
        }
        
        .stats {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .stat-item {
            flex: 1;
            min-width: 200px;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #1976d2;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 500;
            color: #1976d2;
        }
        
        .footer {
            text-align: center;
            padding: 2rem;
            color: #666;
            border-top: 1px solid #ddd;
            margin-top: 3rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè™ OBS CAISSE - Interface de Test</h1>
        <p>Syst√®me de Point de Vente - SONUTEC SARL</p>
    </div>

    <div class="container">
        <div class="card">
            <h2>üì° Statut de Connexion Supabase</h2>
            <div id="connection-status">
                <div class="status-loading">
                    <div class="spinner"></div>
                    <span>Test de connexion en cours...</span>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>üìä R√©sum√© des Donn√©es</h2>
                <div class="stats" id="data-summary">
                    <div class="stat-item">
                        <div class="stat-number" id="clients-count">-</div>
                        <div>Clients</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="stores-count">-</div>
                        <div>Boutiques</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="products-count">-</div>
                        <div>Produits</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="subscriptions-count">-</div>
                        <div>Abonnements</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üß™ Actions de Test</h2>
                <button class="btn" onclick="createTestSale()" id="create-sale-btn" disabled>
                    Cr√©er Vente Test
                </button>
                <button class="btn btn-outline" onclick="loadData()">
                    Recharger Donn√©es
                </button>
                <button class="btn btn-outline" onclick="openBrowser()">
                    Ouvrir dans Navigateur
                </button>
            </div>
        </div>

        <div class="card" id="products-table" style="display: none;">
            <h2>üì± Catalogue Produits</h2>
            <table>
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Cat√©gorie</th>
                        <th>Prix Base</th>
                    </tr>
                </thead>
                <tbody id="products-tbody">
                </tbody>
            </table>
        </div>

        <div class="card" id="stores-table" style="display: none;">
            <h2>üè™ Boutiques du R√©seau</h2>
            <table>
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Adresse</th>
                        <th>T√©l√©phone</th>
                    </tr>
                </thead>
                <tbody id="stores-tbody">
                </tbody>
            </table>
        </div>
    </div>

    <div class="footer">
        <p>D√©velopp√© par SONUTEC SARL - OBS CAISSE v1.0</p>
        <p>Interface de test - Base de donn√©es Supabase</p>
    </div>

    <script>
        // Configuration Supabase
        const supabaseUrl = 'https://vhahwekekuuntqlkvtoc.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZoYWh3ZWtla3V1bnRxbGt2dG9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NDgzNDUsImV4cCI6MjA2OTUyNDM0NX0.EQtEA-4GqM19vSNEoIF3HgczMEXoelS-o9VyExP2dpw';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        let testData = {
            clients: [],
            stores: [],
            products: [],
            subscriptions: [],
            imeiRecords: []
        };

        async function loadData() {
            try {
                document.getElementById('connection-status').innerHTML = `
                    <div class="status-loading">
                        <div class="spinner"></div>
                        <span>Test de connexion en cours...</span>
                    </div>
                `;

                // Test de connexion
                const { data: clients, error: clientsError } = await supabase
                    .from('obs_clients')
                    .select('*')
                    .limit(10);

                if (clientsError) throw clientsError;

                const { data: stores, error: storesError } = await supabase
                    .from('obs_stores')
                    .select('*')
                    .limit(10);

                if (storesError) throw storesError;

                const { data: products, error: productsError } = await supabase
                    .from('obs_products_catalog')
                    .select('*')
                    .limit(10);

                if (productsError) throw productsError;

                const { data: subscriptions, error: subscriptionsError } = await supabase
                    .from('obs_subscriptions')
                    .select('*')
                    .limit(10);

                if (subscriptionsError) throw subscriptionsError;

                testData = {
                    clients: clients || [],
                    stores: stores || [],
                    products: products || [],
                    subscriptions: subscriptions || [],
                    imeiRecords: []
                };

                // Mise √† jour de l'interface
                document.getElementById('connection-status').innerHTML = `
                    <div class="status-success">
                        ‚úÖ Connexion Supabase √©tablie avec succ√®s !
                    </div>
                `;

                updateDataSummary();
                updateTables();
                
                document.getElementById('create-sale-btn').disabled = testData.stores.length === 0;

            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('connection-status').innerHTML = `
                    <div class="status-error">
                        ‚ùå Erreur de connexion: ${error.message}
                    </div>
                `;
            }
        }

        function updateDataSummary() {
            document.getElementById('clients-count').textContent = testData.clients.length;
            document.getElementById('stores-count').textContent = testData.stores.length;
            document.getElementById('products-count').textContent = testData.products.length;
            document.getElementById('subscriptions-count').textContent = testData.subscriptions.length;
        }

        function updateTables() {
            // Table des produits
            if (testData.products.length > 0) {
                const tbody = document.getElementById('products-tbody');
                tbody.innerHTML = testData.products.map(product => `
                    <tr>
                        <td>${product.nom}</td>
                        <td>${product.categorie}</td>
                        <td>${new Intl.NumberFormat('fr-FR').format(product.prix_base)} F</td>
                    </tr>
                `).join('');
                document.getElementById('products-table').style.display = 'block';
            }

            // Table des boutiques
            if (testData.stores.length > 0) {
                const tbody = document.getElementById('stores-tbody');
                tbody.innerHTML = testData.stores.map(store => `
                    <tr>
                        <td>${store.nom}</td>
                        <td>${store.adresse || '-'}</td>
                        <td>${store.telephone || '-'}</td>
                    </tr>
                `).join('');
                document.getElementById('stores-table').style.display = 'block';
            }
        }

        async function createTestSale() {
            try {
                const { data, error } = await supabase
                    .from('obs_sales')
                    .insert({
                        store_id: testData.stores[0]?.id,
                        montant_total: 450000,
                        imei: `TEST-UI-${Date.now()}`,
                        nom_client: 'Client Test Interface',
                        numero_facture: `FAC-UI-${Date.now()}`,
                        sale_price: 450000
                    })
                    .select();

                if (error) throw error;

                alert('‚úÖ Vente de test cr√©√©e avec succ√®s !');
                console.log('Vente cr√©√©e:', data);
                
                // Recharger les donn√©es
                loadData();
            } catch (error) {
                alert('‚ùå Erreur lors de la cr√©ation de la vente: ' + error.message);
            }
        }

        function openBrowser() {
            window.open('http://localhost:3000', '_blank');
        }

        // Charger les donn√©es au d√©marrage
        loadData();
    </script>
</body>
</html>
